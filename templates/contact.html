{% extends "base.html" %}

{% block title %}Contact Us - Brain Tumor Detection System{% endblock %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<style>
    :root {
        --primary: #2563eb;
        --primary-dark: #1d4ed8;
        --secondary: #0ea5e9;
        --accent: #8b5cf6;
        --light: #f0f9ff;
        --dark: #0f172a;
        --gray: #64748b;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --gradient-start: #4361ee;
        --gradient-end: #3a0ca3;
    }

    body {
        font-family: 'Open Sans', sans-serif;
        color: var(--dark);
        background-color: #f8fafc;
        line-height: 1.6;
        overflow-x: hidden;
    }

    h1, h2, h3, h4, h5, h6 {
        font-family: 'Montserrat', sans-serif;
        font-weight: 700;
    }

    .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Hero Section */
    .hero {
        background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
        padding: 80px 0;
        position: relative;
        overflow: hidden;
        margin: 0;
        width: 100%;
        color: white;
        text-align: center;
    }

    .hero::before {
        content: '';
        position: absolute;
        top: -100px;
        right: -100px;
        width: 400px;
        height: 400px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }

    .hero::after {
        content: '';
        position: absolute;
        bottom: -150px;
        left: -100px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }

    .hero-content {
        position: relative;
        z-index: 1;
    }

    .hero h1 {
        font-size: 3.2rem;
        line-height: 1.2;
        margin-bottom: 20px;
        color: white;
    }

    .hero h1 span {
        color: #93c5fd;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .hero p {
        font-size: 1.3rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 30px;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Contact Section */
    .contact-section {
        padding: 100px 0;
        background-color: white;
    }

    .section-title {
        text-align: center;
        margin-bottom: 60px;
    }

    .section-title h2 {
        font-size: 2.8rem;
        color: var(--dark);
        margin-bottom: 15px;
        position: relative;
        display: inline-block;
    }

    .section-title h2::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 4px;
        background: linear-gradient(to right, var(--primary), var(--accent));
        border-radius: 2px;
    }

    .section-title p {
        color: var(--gray);
        font-size: 1.2rem;
        max-width: 700px;
        margin: 20px auto 0;
    }

    .contact-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 40px;
        margin-top: 50px;
    }

    .contact-info {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

    .contact-card {
        background: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
    }

    .contact-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(to right, var(--primary), var(--accent));
    }

    .contact-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .contact-icon {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 25px;
        font-size: 1.8rem;
        color: white;
    }

    .contact-card h3 {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: var(--dark);
    }

    .contact-card p {
        color: var(--gray);
        line-height: 1.7;
        margin-bottom: 10px;
    }

    .contact-card a {
        color: var(--primary);
        text-decoration: none;
        transition: all 0.3s;
    }

    .contact-card a:hover {
        color: var(--accent);
        text-decoration: underline;
    }

    /* Contact Form */
    .contact-form {
        background: white;
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        position: relative;
        overflow: hidden;
    }

    .contact-form::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(to right, var(--primary), var(--accent));
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
    }

    .form-control {
        width: 100%;
        padding: 15px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s;
        font-family: 'Open Sans', sans-serif;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    textarea.form-control {
        min-height: 150px;
        resize: vertical;
    }

    .btn {
        padding: 15px 30px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .btn-primary {
        background: linear-gradient(to right, var(--primary), var(--accent));
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    /* FAQ Section */
    .faq-section {
        padding: 100px 0;
        background: linear-gradient(to bottom, #f0f9ff, #e0f2fe);
        position: relative;
    }

    .faq-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(to right, transparent, rgba(37, 99, 235, 0.3), transparent);
    }

    .accordion {
        margin-top: 50px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .accordion-item {
        background: white;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        overflow: hidden;
    }

    .accordion-header {
        padding: 25px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--dark);
        transition: all 0.3s;
    }

    .accordion-header:hover {
        color: var(--primary);
    }

    .accordion-content {
        padding: 0 25px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out, padding 0.3s ease;
        color: var(--gray);
        line-height: 1.7;
    }

    .accordion-item.active .accordion-content {
        max-height: 500px;
        padding: 0 25px 25px;
    }

    .accordion-item.active .accordion-icon {
        transform: rotate(180deg);
    }

    .accordion-icon {
        transition: transform 0.3s;
    }

    /* Map Section */
    .map-section {
        padding: 80px 0;
        background: white;
    }

    .map-container {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        margin-top: 50px;
    }

    .map-container iframe {
        width: 100%;
        height: 400px;
        border: none;
        display: block;
    }

    /* Inbox Icon Styles */
    .inbox-icon {
        position: fixed;
        bottom: 30px;
        left: 30px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--success), var(--primary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        transition: all 0.3s ease;
    }

    .inbox-icon:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .inbox-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--danger);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    }

    /* Messages Modal */
    .messages-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        justify-content: center;
        align-items: center;
    }

    .messages-modal-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        position: relative;
    }

    .messages-modal-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: between;
        align-items: center;
    }

    .messages-modal-body {
        padding: 20px;
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--gray);
    }

    .message-item {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }

    .message-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .admin-reply {
        background: #f0f9ff;
        border-left: 4px solid var(--primary);
        padding: 12px;
        margin-top: 10px;
        border-radius: 4px;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
        .contact-grid {
            grid-template-columns: 1fr;
        }
        
        .hero h1 {
            font-size: 2.8rem;
        }
    }

    @media (max-width: 768px) {
        .contact-form {
            padding: 30px 20px;
        }
        
        .section-title h2 {
            font-size: 2.2rem;
        }
        
        .hero h1 {
            font-size: 2.5rem;
        }
        
        .hero p {
            font-size: 1.1rem;
        }
    }

    /* Floating Chatbot Icon */
    .chatbot-icon {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        transition: all 0.3s ease;
    }

    .chatbot-icon:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .chatbot-icon::after {
        content: '';
        position: absolute;
        top: -5px;
        left: -5px;
        right: -5px;
        bottom: -5px;
        border-radius: 50%;
        border: 2px solid var(--primary);
        opacity: 0;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7); }
        70% { box-shadow: 0 0 0 15px rgba(79, 70, 229, 0); }
        100% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }
    }
</style>

<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <div class="hero-content" data-aos="fade-up" data-aos-duration="1000">
            <h1>Get in <span>Touch</span> With Us</h1>
            <p>Have questions about our Brain Tumor Detection System? Our team is here to help you with any inquiries.</p>
        </div>
    </div>
</section>

<!-- Contact Section -->
<section class="contact-section">
    <div class="container">
        <div class="section-title" data-aos="fade-up" data-aos-duration="800">
            <h2>Contact Information</h2>
            <p>Reach out to us through any of the following channels</p>
        </div>
        
        <div class="contact-grid">
            <div class="contact-info">
                <div class="contact-card" data-aos="fade-up" data-aos-duration="800">
                    <div class="contact-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h3>Our Location</h3>
                    <p>NeuroScanAI</p>
                    <p>No-123</p>
                    <p>Colombo,Sri Lanka</p>
                </div>
                
                <div class="contact-card" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                    <div class="contact-icon">
                        <i class="fas fa-phone-alt"></i>
                    </div>
                    <h3>Phone Number</h3>
                    <p>General Inquiries: <a href="tel:+18001234567">011-1234567</a></p>
                    <p>Technical Support: <a href="tel:+18007654321">071-2494773</a></p>
                </div>
                
                <div class="contact-card" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <h3>Email Address</h3>
                    <p>General: <a href="mailto:info@neuroscaniai.com">info@neuroscaniai.com</a></p>
                    <p>Support: <a href="mailto:support@neuroscaniai.com">support@neuroscaniai.com</a></p>
                    <p>Partnerships: <a href="mailto:partners@neuroscaniai.com">partners@neuroscaniai.com</a></p>
                </div>
            </div>
            
            <div class="contact-form" data-aos="fade-up" data-aos-duration="800" data-aos-delay="300">
                <h3 style="margin-bottom: 25px; color: var(--dark);">Send Us a Message</h3>

                <!-- Update the form to use Flask-WTF or process with Flask -->
<form id="contactForm" method="POST" action="{{ url_for('main.contact') }}">
    {{ form.hidden_tag() }}
    
    <div class="form-group">
        <label for="name">Full Name</label>
        {{ form.name(class="form-control", placeholder="Your name", id="nameField") }}
        {% for error in form.name.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    
    <div class="form-group">
        <label for="email">Email Address</label>
        {{ form.email(class="form-control", placeholder="Your email", id="emailField") }}
        {% for error in form.email.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    
    <div class="form-group">
        <label for="subject">Subject</label>
        {{ form.subject(class="form-control", placeholder="Message subject", id="subjectField") }}
        {% for error in form.subject.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    
    <div class="form-group">
        <label for="message">Message</label>
        {{ form.message(class="form-control", placeholder="Your message", rows=5, id="messageField") }}
        {% for error in form.message.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    
    <button type="submit" class="btn btn-primary" id="submitButton">
        <i class="fas fa-paper-plane"></i> Send Message
    </button>
</form>
            </div>
        </div>
    </div>
</section>

<!-- Inbox Icon -->
<div class="inbox-icon" onclick="openMessagesModal()">
    <i class="fas fa-inbox"></i>
    <span class="inbox-badge" id="messageCount">0</span>
</div>

<!-- Messages Modal -->
<div class="messages-modal" id="messagesModal">
    <div class="messages-modal-content">
        <div class="messages-modal-header">
            <h3>My Messages & Replies</h3>
            <button class="close-modal" onclick="closeMessagesModal()">&times;</button>
        </div>
        <div class="messages-modal-body" id="messagesList">
            <div class="text-center">
                <p>Loading your messages...</p>
            </div>
        </div>
    </div>
</div>

<!-- FAQ Section -->
<section class="faq-section">
    <div class="container">
        <div class="section-title" data-aos="fade-up" data-aos-duration="800">
            <h2>Frequently Asked Questions</h2>
            <p>Find answers to common questions about our Brain Tumor Detection System</p>
        </div>
        
        <div class="accordion">
            <div class="accordion-item" data-aos="fade-up" data-aos-duration="800">
                <div class="accordion-header">
                    How accurate is the AI detection system?
                    <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="accordion-content">
                    Our AI system has been validated to achieve 98% accuracy in detecting brain tumors from MRI scans. This accuracy rate is based on extensive testing with thousands of verified medical cases and has been confirmed by leading neurologists.
                </div>
            </div>
            
            <div class="accordion-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="100">
                <div class="accordion-header">
                    What file formats do you accept for MRI scans?
                    <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="accordion-content">
                    We accept DICOM files (preferred) as well as common image formats including JPEG, PNG, and TIFF. For optimal results, we recommend using DICOM files as they contain more detailed medical information.
                </div>
            </div>
            
            <div class="accordion-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
                <div class="accordion-header">
                    How long does it take to get results?
                    <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="accordion-content">
                    Our AI analysis typically takes between 5-15 minutes depending on the complexity of the scan and current system load. You will receive a notification via email once your results are ready.
                </div>
            </div>
            
            <div class="accordion-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="300">
                <div class="accordion-header">
                    Is my medical data secure?
                    <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="accordion-content">
                    Yes, we take data security extremely seriously. All medical data is encrypted both in transit and at rest. We are HIPAA compliant and follow all relevant medical data protection regulations. Your data is never shared with third parties without your explicit consent.
                </div>
            </div>
            
            <div class="accordion-item" data-aos="fade-up" data-aos-duration="800" data-aos-delay="400">
                <div class="accordion-header">
                    Can healthcare institutions integrate with your system?
                    <span class="accordion-icon"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="accordion-content">
                    Yes, we offer API integration and custom deployment options for healthcare institutions. Our team can work with your IT department to ensure seamless integration with your existing systems. Please contact our partnerships team for more information.
                </div>
            </div>
        </div>
    </div>
</section>





<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
document.getElementById('contactForm').addEventListener('submit', function(e) {
    console.log('Form submitted');
    console.log('Name:', document.getElementById('nameField').value);
    // Add similar logs for other fields
});

</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });
        
        // Accordion functionality
        const accordionHeaders = document.querySelectorAll('.accordion-header');
        
        accordionHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const item = this.parentNode;
                const isActive = item.classList.contains('active');
                
                // Close all items
                document.querySelectorAll('.accordion-item').forEach(accItem => {
                    accItem.classList.remove('active');
                });
                
                // Open clicked item if it wasn't active
                if (!isActive) {
                    item.classList.add('active');
                }
            });
        });
        
        // Simple animation for the chatbot icon
        const chatIcon = document.querySelector('.chatbot-icon');
        
        setInterval(() => {
            chatIcon.style.transform = 'translateY(-5px)';
            setTimeout(() => {
                chatIcon.style.transform = 'translateY(0)';
            }, 500);
        }, 3000);
    });
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const contactForm = document.getElementById('contactForm');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            console.log('FORM SUBMISSION DETECTED');
            console.log('Name value:', document.querySelector('[name="name"]').value);
            console.log('Email value:', document.querySelector('[name="email"]').value);
            console.log('Subject value:', document.querySelector('[name="subject"]').value);
            console.log('Message value:', document.querySelector('[name="message"]').value);
            
            // Let the form submit normally - DON'T prevent default
            // This will allow us to see what happens on the server side

            alert('Thank you for your message! Our team will get back to you soon.');
        });
    }
});
</script>

<script>
    let userMessages = [];

    function openMessagesModal() {
        document.getElementById('messagesModal').style.display = 'flex';
        loadUserMessages();
    }

    function closeMessagesModal() {
        document.getElementById('messagesModal').style.display = 'none';
    }

    function loadUserMessages() {
        // Show loading state
        document.getElementById('messagesList').innerHTML = `
            <div class="text-center">
                <p>Loading your messages...</p>
            </div>
        `;

        // Fetch user messages from API
        fetch('/api/my-messages')
            .then(response => response.json())
            .then(messages => {
                userMessages = messages;
                updateMessagesDisplay();
                updateMessageCount();
            })
            .catch(error => {
                console.error('Error loading messages:', error);
                document.getElementById('messagesList').innerHTML = `
                    <div class="alert alert-danger">
                        Error loading messages. Please try again.
                    </div>
                `;
            });
    }

    function updateMessagesDisplay() {
        const messagesList = document.getElementById('messagesList');
        
        if (userMessages.length === 0) {
            messagesList.innerHTML = `
                <div class="text-center">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <p>No messages yet.</p>
                    <p>Send us a message and we'll get back to you!</p>
                </div>
            `;
            return;
        }

        messagesList.innerHTML = userMessages.map(message => `
            <div class="message-item">
                <div class="message-header">
                    <strong>${message.subject}</strong>
                    <small class="text-muted">${new Date(message.created_at).toLocaleDateString()}</small>
                </div>
                <p>${message.message}</p>
                
                ${message.replies && message.replies.length > 0 ? `
                    <div class="admin-replies">
                        <h6>Admin Responses:</h6>
                        ${message.replies.map(reply => `
                            <div class="admin-reply">
                                <div class="d-flex justify-content-between">
                                    <strong>Admin</strong>
                                    <small>${new Date(reply.created_at).toLocaleDateString()}</small>
                                </div>
                                <p class="mb-0">${reply.reply_text}</p>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div class="alert alert-secondary mt-2">
                        <small>No responses yet. We'll get back to you soon!</small>
                    </div>
                `}
            </div>
        `).join('');
    }

    function updateMessageCount() {
        const totalUnread = userMessages.filter(msg => 
            msg.status === 'new' || (msg.replies && msg.replies.length > 0 && msg.replies.some(reply => !reply.read))
        ).length;
        
        const badge = document.getElementById('messageCount');
        badge.textContent = totalUnread;
        badge.style.display = totalUnread > 0 ? 'flex' : 'none';
    }

    // Close modal when clicking outside
    document.getElementById('messagesModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeMessagesModal();
        }
    });

    // Load message count on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user is logged in
        fetch('/api/check-auth')
            .then(response => response.json())
            .then(data => {
                if (data.authenticated) {
                    loadUserMessages();
                }
            })
            .catch(() => {
                // User not logged in, hide inbox icon
                document.querySelector('.inbox-icon').style.display = 'none';
            });
    });
</script>

<script>
    (function() {
        if (!window.chatbase || window.chatbase("getState") !== "initialized") {
            window.chatbase = (...arguments) => {
                if (!window.chatbase.q) {
                    window.chatbase.q = []
                }
                window.chatbase.q.push(arguments)
            };
            window.chatbase = new Proxy(window.chatbase, {
                get(target, prop) {
                    if (prop === "q") {
                        return target.q
                    }
                    return (...args) => target(prop, ...args)
                }
            })
        }
        const onLoad = function() {
            const script = document.createElement("script");
            script.src = "https://www.chatbase.co/embed.min.js";
            script.id = "UrNy35TOL9iDi6C-kRSTM";
            script.domain = "www.chatbase.co";
            document.body.appendChild(script)
        };
        if (document.readyState === "complete") {
            onLoad()
        } else {
            window.addEventListener("load", onLoad)
        }
    })();
</script>
<script>
    const crypto = require('crypto');

    const secret = 'UrNy35TOL9iDi6C-kRSTM'; 
    const userId = current_user.id 

    const hash = crypto.createHmac('sha256', secret).update(userId).digest('hex');
</script>

{% endblock %}

{% block footer %}
{% include "footer.html" %}
{% endblock %}